# Puente.Lokal Colombia - Documentaci√≥n T√©cnica

## üìã Descripci√≥n del Proyecto

**Puente.Lokal Colombia** es una plataforma web desarrollada en Laravel que conecta comercios locales de Puente Nacional, Santander con clientes de la regi√≥n y visitantes. La plataforma permite la gesti√≥n completa de comercios, servicios, contactos y contenido de forma totalmente gratuita, funcionando como un directorio empresarial con funcionalidades avanzadas de b√∫squeda, filtrado y contacto directo.

## üõ†Ô∏è Stack Tecnol√≥gico

### Backend
- **Laravel 12.x** - Framework PHP principal
- **PHP 8.2+** - Lenguaje de programaci√≥n
- **MySQL/MariaDB** - Base de datos principal
- **SQLite** - Base de datos para desarrollo local

### Frontend
- **Blade Templates** - Motor de plantillas de Laravel
- **Tailwind CSS 3.x** - Framework CSS
- **Alpine.js 3.x** - JavaScript reactivo
- **Vite 7.x** - Bundler de assets

### Herramientas de Desarrollo
- **Laravel Breeze** - Autenticaci√≥n
- **Laravel Tinker** - REPL para Laravel
- **Laravel Pint** - Code Style Fixer
- **PHPUnit** - Testing framework
- **Faker** - Generaci√≥n de datos de prueba

### Integraciones
- **Google reCAPTCHA Enterprise** - Protecci√≥n contra bots
- **WhatsApp Business API** - Comunicaci√≥n con comercios
- **Cloudflare/AWS** - CDN y almacenamiento de im√°genes

## üèóÔ∏è Arquitectura del Proyecto

### Estructura de Carpetas

```
app/
‚îú‚îÄ‚îÄ Console/Commands/        # Comandos Artisan personalizados
‚îú‚îÄ‚îÄ Enums/                  # Enumeraciones (estados, tipos)
‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/        # Controladores principales
‚îÇ   ‚îú‚îÄ‚îÄ Middleware/         # Middleware personalizado
‚îÇ   ‚îî‚îÄ‚îÄ Requests/           # Form Request Validation
‚îú‚îÄ‚îÄ Mail/                   # Clases de email
‚îú‚îÄ‚îÄ Models/                 # Modelos Eloquent
‚îú‚îÄ‚îÄ Notifications/          # Notificaciones
‚îú‚îÄ‚îÄ Providers/              # Service Providers
‚îú‚îÄ‚îÄ Rules/                  # Reglas de validaci√≥n personalizadas
‚îú‚îÄ‚îÄ Services/               # L√≥gica de negocio
‚îî‚îÄ‚îÄ View/Components/        # Componentes Blade

database/
‚îú‚îÄ‚îÄ factories/              # Model factories
‚îú‚îÄ‚îÄ migrations/             # Migraciones de BD
‚îî‚îÄ‚îÄ seeders/               # Seeders

resources/
‚îú‚îÄ‚îÄ css/                   # Archivos CSS/Tailwind
‚îú‚îÄ‚îÄ js/                    # JavaScript/Alpine.js
‚îî‚îÄ‚îÄ views/                 # Plantillas Blade

routes/
‚îú‚îÄ‚îÄ auth.php               # Rutas de autenticaci√≥n
‚îú‚îÄ‚îÄ console.php            # Rutas de consola
‚îî‚îÄ‚îÄ web.php                # Rutas web principales
```

### Base de Datos - Tablas Principales

#### Comercios y Servicios
- `tMarketComerciosServicios` - Informaci√≥n principal de comercios
- `tMarketComerciosServiciosInformacion` - Informaci√≥n adicional
- `tMarketComerciosServiciosDatosContacto` - Datos de contacto
- `tMarketComercioServicioImagenes` - Im√°genes del comercio
- `tMarketComerciosServiciosContactosMultiples` - Contactos m√∫ltiples

#### Clasificaci√≥n
- `tMarketCategorias` - Categor√≠as de comercios
- `tMarketTiposComercioServicio` - Tipos de comercio/servicio

#### Usuarios y Autenticaci√≥n
- `users` - Usuarios del sistema (Laravel Breeze)
- `tUsuario` - Tabla de usuarios legacy

#### Sistema
- `tMarketFavoritos` - Favoritos de usuarios
- `tMarketComercioServicioComentarios` - Comentarios y calificaciones
- `tMarketComerciosComunicados` - Comunicaciones autom√°ticas

## üöÄ Instalaci√≥n Local

### Requisitos Previos
- PHP 8.2 o superior
- Composer 2.x
- Node.js 18+ y npm
- MySQL 8.0+ o MariaDB 10.x
- Git

### Pasos de Instalaci√≥n

1. **Clonar el repositorio**
```bash
git clone <repository-url> puentelokalcolobia
cd puentelokalcolobia
```

2. **Instalar dependencias PHP**
```bash
composer install
```

3. **Instalar dependencias JavaScript**
```bash
npm install
```

4. **Configurar variables de entorno**
```bash
cp .env.example .env
php artisan key:generate
```

5. **Configurar base de datos en .env**
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=puentelokal_db
DB_USERNAME=root
DB_PASSWORD=your_password
```

6. **Ejecutar migraciones y seeders**
```bash
php artisan migrate
php artisan db:seed --class=PuenteLokalSeeder
```

7. **Generar datos de ejemplo (opcional)**
```bash
php artisan create:sample-data
```

8. **Compilar assets**
```bash
npm run dev
# o para producci√≥n
npm run build
```

9. **Iniciar servidor de desarrollo**
```bash
php artisan serve
```

### Configuraci√≥n Adicional

#### Storage Link
```bash
php artisan storage:link
```

#### Permisos (Linux/Mac)
```bash
chmod -R 755 storage bootstrap/cache
```

## üåê Despliegue en Producci√≥n

### Servidor Web
- **Nginx** o **Apache** con PHP-FPM
- **SSL Certificate** (Let's Encrypt recomendado)
- **PHP 8.2+** con extensiones: BCMath, Ctype, Fileinfo, JSON, Mbstring, OpenSSL, PDO, Tokenizer, XML

### Variables de Entorno de Producci√≥n
```env
APP_NAME="Puente.Lokal Colombia"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://puente.lokalcolombia.com

DB_CONNECTION=mysql
DB_HOST=your_database_host
DB_DATABASE=your_database_name
DB_USERNAME=your_database_user
DB_PASSWORD=your_secure_password

MAIL_MAILER=smtp
MAIL_HOST=your_smtp_host
MAIL_PORT=587
MAIL_USERNAME=noreply@puente.lokalcolombia.com
MAIL_PASSWORD=your_mail_password
MAIL_FROM_ADDRESS=noreply@puente.lokalcolombia.com

# Google reCAPTCHA Enterprise
RECAPTCHA_SITE_KEY=your_site_key
RECAPTCHA_SECRET_KEY=your_secret_key
RECAPTCHA_API_KEY=your_google_cloud_api_key
RECAPTCHA_PROJECT_ID=your_project_id
RECAPTCHA_ENABLED=true

# Almacenamiento
FILESYSTEM_DISK=s3
AWS_ACCESS_KEY_ID=your_aws_key
AWS_SECRET_ACCESS_KEY=your_aws_secret
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=puentelokal-storage
```

### Comandos de Despliegue
```bash
# Optimizaci√≥n de producci√≥n
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan event:cache

# Migrar base de datos
php artisan migrate --force

# Limpiar cach√©s si es necesario
php artisan cache:clear
php artisan config:clear
```

### Backup Autom√°tico
```bash
# Configurar cron job para backups diarios
0 2 * * * cd /path/to/project && php artisan backup:run
```

## üîê Autenticaci√≥n y Seguridad

### Sistema de Autenticaci√≥n
- **Laravel Breeze** - Sistema de autenticaci√≥n completo
- **Verificaci√≥n de email** obligatoria para comerciantes
- **Roles de usuario**: `admin`, `comerciante`
- **Middleware de autenticaci√≥n** personalizado

### Roles y Permisos
```php
// Middleware para admin
Route::middleware(['auth', 'role:admin'])->group(function () {
    // Rutas de administraci√≥n
});

// Usuarios comerciantes
$user->rol === 'comerciante'
$user->market_commerce_service_id // ID del comercio asociado
```

### Protecci√≥n CSRF
- Tokens CSRF en todos los formularios
- Validaci√≥n autom√°tica en requests POST

### reCAPTCHA Enterprise
- Protecci√≥n en formularios de registro, login y recuperaci√≥n
- Detecci√≥n autom√°tica de ambiente (deshabilitado en local)
- Scores configurables por acci√≥n

## üìä M√≥dulos Principales

### 1. Gesti√≥n de Comercios
**Modelos**: `MarketComercioServicio`, `MarketComerciosServiciosInformacion`

**Funcionalidades**:
- CRUD completo de comercios
- Estados: pendiente, aprobado, rechazado, eliminado
- Generaci√≥n autom√°tica de slugs √∫nicos
- Gesti√≥n de m√∫ltiples im√°genes con orden
- Datos de contacto m√∫ltiples (tel√©fonos, emails, redes sociales)

**Service Layer**: `ComercioService`
```php
// Crear comercio
$comercio = $comercioService->createComercio($data, $userId);

// Actualizar comercio
$comercio = $comercioService->updateComercio($comercio, $data);
```

### 2. Sistema de Categor√≠as y Tipos
**Modelos**: `MarketCategoria`, `MarketTipoComercioServicio`

- Clasificaci√≥n jer√°rquica de comercios
- Iconos y slugs para SEO
- Estados activo/inactivo

### 3. Gesti√≥n de Im√°genes
**Modelo**: `MarketComercioServicioImagen`

- Subida m√∫ltiple de im√°genes
- Orden autom√°tico y reordenamiento
- Eliminaci√≥n en cascada (archivo f√≠sico + registro)
- Validaci√≥n de tipos y tama√±os

### 4. Sistema de Contactos
**Modelo**: `MarketComerciosServiciosDatosContacto`

- Contactos m√∫ltiples con separador "|"
- Formateo autom√°tico de n√∫meros telef√≥nicos
- Validaci√≥n de URLs y redes sociales
- Integraci√≥n con WhatsApp Business

### 5. Comentarios y Calificaciones
**Modelo**: `MarketComercioServicioComentario`

- Sistema de puntuaci√≥n 1-5 estrellas
- Moderaci√≥n de comentarios
- Filtros anti-spam por IP

## üîå API Endpoints

### P√∫blicos
```php
GET /                          # P√°gina principal
GET /comercios                 # Listado de comercios
GET /comercio/{slug}          # Detalle de comercio
POST /contacto                # Env√≠o de formulario de contacto
```

### Autenticados
```php
GET /dashboard                    # Dashboard usuario
GET /dashboard/comercio          # Gesti√≥n de comercio
PUT /dashboard/comercio          # Actualizar comercio
POST /dashboard/resend-verification # Reenviar verificaci√≥n
```

### Administraci√≥n
```php
GET /admin                    # Dashboard admin
GET /admin/comercios         # Gesti√≥n de comercios
GET /admin/categorias        # Gesti√≥n de categor√≠as  
GET /admin/usuarios          # Gesti√≥n de usuarios
```

### API de B√∫squeda
```php
POST /auth/search-comercio   # B√∫squeda para recuperaci√≥n de acceso
```

## ‚öôÔ∏è Variables de Entorno y Configuraci√≥n

### Variables Esenciales
```env
# Aplicaci√≥n
APP_NAME="Puente.Lokal Colombia"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://puente.lokalcolombia.com

# Base de datos
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=puentelokal_db
DB_USERNAME=root
DB_PASSWORD=

# Email
MAIL_MAILER=smtp
MAIL_FROM_ADDRESS=noreply@puente.lokalcolombia.com
MAIL_FROM_NAME="Puente.Lokal Colombia"

# reCAPTCHA
RECAPTCHA_ENABLED=true
RECAPTCHA_SITE_KEY=
RECAPTCHA_SECRET_KEY=
RECAPTCHA_PROJECT_ID=
```

### Configuraciones Especiales
- **Locale**: `es` para espa√±ol
- **Timezone**: `America/Bogota`
- **Upload limits**: 2MB por imagen
- **Session lifetime**: 120 minutos

## üõ†Ô∏è Mantenimiento y Buenas Pr√°cticas

### Logs y Monitoreo
```bash
# Ver logs en tiempo real
tail -f storage/logs/laravel.log

# Limpiar logs antiguos
php artisan log:clear

# Monitorear errores
php artisan queue:monitor
```

### Actualizaciones
```bash
# Actualizar dependencias
composer update
npm update

# Ejecutar migraciones nuevas
php artisan migrate

# Limpiar cach√©s
php artisan optimize:clear
```

### Performance
```bash
# Cachear configuraci√≥n
php artisan config:cache

# Cachear rutas
php artisan route:cache

# Optimizar autoloader
composer dump-autoload --optimize
```

### Escalabilidad
- **Redis** para sessions y cache
- **Queues** para tareas pesadas (emails, im√°genes)
- **CDN** para assets est√°ticos
- **Load Balancer** para m√∫ltiples servidores

### Backup Estrategia
```bash
# Backup de base de datos
mysqldump -u user -p database > backup_$(date +%Y%m%d).sql

# Backup de archivos
tar -czf storage_backup_$(date +%Y%m%d).tar.gz storage/app/public
```

## üß™ Testing y Validaciones

### Testing Recomendado
```bash
# Tests unitarios
php artisan test --testsuite=Unit

# Tests de feature
php artisan test --testsuite=Feature

# Coverage
php artisan test --coverage
```

### Validaciones Cr√≠ticas
1. **Registro de comercio**: Validar todos los campos obligatorios
2. **Subida de im√°genes**: Verificar tipos y tama√±os
3. **Estados de comercio**: Validar transiciones de estado
4. **Datos de contacto**: Validar formatos de tel√©fono y email
5. **Slugs √∫nicos**: Verificar unicidad en creaci√≥n/edici√≥n

### Casos de Prueba Prioritarios
- [ ] Registro de nuevo comercio con todos los datos
- [ ] Login con usuario verificado/no verificado
- [ ] B√∫squeda y filtrado de comercios
- [ ] Subida m√∫ltiple de im√°genes
- [ ] Edici√≥n de datos de contacto
- [ ] Cambio de estados por admin
- [ ] Recuperaci√≥n de acceso por nombre de comercio
- [ ] Protecci√≥n reCAPTCHA en formularios

### Comandos de Desarrollo
```bash
# Crear datos de ejemplo
php artisan create:sample-data

# Crear usuarios por defecto para comercios
php artisan users:create-defaults

# Probar configuraci√≥n reCAPTCHA
php artisan recaptcha:test

# Limpiar datos de prueba
php artisan migrate:fresh --seed
```

---

## üìû Soporte T√©cnico

Para dudas t√©cnicas o problemas de implementaci√≥n, contactar al equipo de desarrollo a trav√©s de los canales establecidos en el proyecto.

**Proyecto**: Puente.Lokal Colombia - Plataforma gratuita para comercios de Puente Nacional
**Documentaci√≥n actualizada**: Septiembre 2025
**Versi√≥n Laravel**: 12.x
**Versi√≥n PHP**: 8.2+